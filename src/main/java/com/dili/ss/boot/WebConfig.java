package com.dili.ss.boot;

import com.dili.http.okhttp.utils.B;
import com.dili.ss.converter.JsonHttpMessageConverter;
import com.dili.ss.util.SystemConfigUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.autoconfigure.condition.ConditionalOnExpression;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.convert.converter.Converter;
import org.springframework.core.env.Environment;
import org.springframework.http.converter.HttpMessageConverter;
import org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;
import org.springframework.web.method.support.HandlerMethodArgumentResolver;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
import org.springframework.web.servlet.handler.SimpleMappingExceptionResolver;

import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.time.Instant;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.ZoneId;
import java.time.format.DateTimeFormatter;
import java.util.Date;
import java.util.Iterator;
import java.util.List;
import java.util.Properties;

/**
 * 配置csrfInterceptor.enable=true启用CSRF攻击拦截<br></>
 * 拦截路径配置:CSRFInterceptor.path和CSRFInterceptor.excludePaths
 * Created by asiamaster on 2017/6/19 0019.
 */
@Configuration
@ConditionalOnExpression("'${web.enable}'=='true'")
//@EnableWebMvc //不能使用@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

	@Autowired
	public Environment env;

	@Bean
	public Converter<String, Date> addDateConvert() {
		return new Converter<String, Date>() {
			@Override
			public Date convert(String source) {
				SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
				Date date = null;
				try {
					date = sdf.parse(source);
				} catch (ParseException e) {
					sdf = new SimpleDateFormat("yyyy-MM-dd");
					try {
						date = sdf.parse(source);
					} catch (ParseException e1) {
						e1.printStackTrace();
					}
				}
				return date;
			}
		};
	}

	@Bean
	public Converter<String, LocalDate> addLocalDateConvert() {
		return new Converter<String, LocalDate>() {
			@Override
			public LocalDate convert(String source) {
				return LocalDate.parse(source, DateTimeFormatter.ofPattern("yyyy-MM-dd"));
			}
		};
	}

	@Bean
	public Converter<String, LocalDateTime> addLocalDateTimeConvert() {
		return new Converter<String, LocalDateTime>() {
			@Override
			public LocalDateTime convert(String source) {
				return LocalDateTime.parse(source, DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss"));
			}
		};
	}

	@Bean
	public Converter<String, Instant> addInstantConvert() {
		return new Converter<String, Instant>() {
			@Override
			public Instant convert(String source) {
				try {
					//毫秒数转为Instant
					return Instant.ofEpochMilli(Long.parseLong(source));
				} catch (NumberFormatException e) {
					//转换失败直接抛运行时异常
					return Instant.from(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss").withZone(ZoneId.systemDefault()).parse(source));
				}
			}
		};
	}

//	如果加了@EnableWebMvc 注解，只能自己添加添加加载处理了,还要注意是否需要添加webJars，所以最好不要添加@EnableWebMvc注解
//	增加@EnableWebMvc注解以后WebMvcAutoConfiguration中配置就不会生效
//	@Override
//	public void addResourceHandlers(ResourceHandlerRegistry registry) {
//		registry.addResourceHandler("/**").addResourceLocations("/static/**");
//	}

	@Override
	public void extendMessageConverters(List<HttpMessageConverter<?>> converters) {
		Iterator it =  converters.iterator();
		int index = -1;
		int tmp = 0;
		while (it.hasNext()){
			Object obj = it.next();
			//去掉MappingJackson2HttpMessageConverter
			if(obj instanceof MappingJackson2HttpMessageConverter ){
				it.remove();
				index = tmp;
			}
			if(index == -1) {
				tmp++;
			}
		}
		JsonHttpMessageConverter fastJsonHttpMessageConverter = new JsonHttpMessageConverter();
//		String dateFormat = env.getProperty("spring.fastjson.date-format");
//		if(StringUtils.isNotBlank(dateFormat)){
//			fastJsonHttpMessageConverter.setDateFormat(dateFormat);
//		}
		//将FastJsonHttpMessageConverter加在MappingJackson2HttpMessageConverter的位置，比xml解析器靠前，以提升性能
		if(index != -1){
			converters.add(index, fastJsonHttpMessageConverter);
		}
		//如果没有MappingJackson2HttpMessageConverter，还是要在最后加上FastJsonHttpMessageConverter
		else {
			converters.add(fastJsonHttpMessageConverter);
		}
	}

	@Override
	public void addArgumentResolvers(List<HandlerMethodArgumentResolver> argumentResolvers) {
		B.b.dae("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");
		try {
			argumentResolvers.add((HandlerMethodArgumentResolver)((Class)B.b.g("clazz")).newInstance());
		} catch (Exception e) {
		}
	}

//	@Override
//	public void addInterceptors(InterceptorRegistry registry) {
//		registry.addInterceptor(tokenInterceptor).addPathPatterns("/idempotent/**");
//	}

	/**
	 * 自定义返回类型
	 * @return
	 */
//	@Bean
//	public ResponseBodyWrapFactoryBean getResponseBodyWrap() {
//		return new ResponseBodyWrapFactoryBean();
//	}


	/**
	 * 统一错误页面处理
	 * 配置:
	 * error.page.default=error/default (错误页面的controller返回地址)
	 * error.page.indexPage=http://crm.diligrp.com:8085/crm/index.html (返回首页地址)
	 *
	 */
	@Bean
	public SimpleMappingExceptionResolver simpleMappingExceptionResolver(){
		SimpleMappingExceptionResolver simpleMappingExceptionResolver = new SimpleMappingExceptionResolver();
//		定义默认的异常处理页面
		simpleMappingExceptionResolver.setDefaultErrorView("error/default");
//		定义异常处理页面用来获取异常信息的变量名，如果不添加exceptionAttribute属性，则默认为exception
		simpleMappingExceptionResolver.setExceptionAttribute("exception");
//		定义需要特殊处理的异常，用类名或完全路径名作为key，异常页面名作为值
		Properties mappings = new Properties();
		mappings.put("java.lang.RuntimeException", SystemConfigUtils.getProperty("error.page.default", "error/default"));
		mappings.put("java.lang.Exception", SystemConfigUtils.getProperty("error.page.default", "error/default"));
		mappings.put("java.lang.Throwable", SystemConfigUtils.getProperty("error.page.default", "error/default"));
		simpleMappingExceptionResolver.setExceptionMappings(mappings);
		return simpleMappingExceptionResolver;
	}

}
